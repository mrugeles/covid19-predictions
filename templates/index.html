{% extends "template.html" %}

{% block content %}
<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Covid-19 Projections</h1>
</div>
<div>
    <a href="https://github.com/CSSEGISandData/COVID-19" target="_top"> COVID-19 Data Repository</a> by the Center for Systems Science and Engineering (CSSE) at Johns Hopkins University.
</div>
<br/>
<div class="row">
    <div class="col-xl-12">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Daily cases</h6>
            </div>
            <div class="card-body" style="height:500px;">
                <div class="chart-area">
                    <div class="chartjs-size-monitor">
                        <div class="chartjs-size-monitor-expand">
                            <div class=""></div>
                        </div>
                        <div class="chartjs-size-monitor-shrink">
                            <div class=""></div>
                        </div>
                    </div>
                    <div id="daily_cases"></div>
                </div>
                <hr>
            </div>
        </div>
    </div>
</div>
<br/>
<div class="row">
    <div class="col-xl-12">
        <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Cases predictions</h6>
                        </div>
                        <div class="card-body" style="height:500px">
                            <div class="chart-area">
                                <div class="chartjs-size-monitor">
                                    <div class="chartjs-size-monitor-expand">
                                        <div class=""></div>
                                    </div>
                                    <div class="chartjs-size-monitor-shrink">
                                        <div class=""></div>
                                    </div>
                                </div>
                                <div id="confirmed_predictions"></div>
                            </div>
                            <hr>
                        </div>
                    </div>
    </div>
</div>
<br/>
<div class="row">
    <div class="col-xl-12">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Death predictions</h6>
            </div>
            <div class="card-body" style="height:500px">
                <div class="chart-area">
                    <div class="chartjs-size-monitor">
                        <div class="chartjs-size-monitor-expand">
                            <div class=""></div>
                        </div>
                        <div class="chartjs-size-monitor-shrink">
                            <div class=""></div>
                        </div>
                    </div>
                    <div id="death_predictions"></div>
                </div>
                <hr>
            </div>
        </div>
    </div>
</div>
<br/>
<div class="row">
    <div class="col-xl-12">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Recovered predictions</h6>
            </div>
            <div class="card-body" style="height:500px">
                <div class="chart-area">
                    <div class="chartjs-size-monitor">
                        <div class="chartjs-size-monitor-expand">
                            <div class=""></div>
                        </div>
                        <div class="chartjs-size-monitor-shrink">
                            <div class=""></div>
                        </div>
                    </div>
                    <div id="recovered_predictions"></div>
                </div>
                <hr>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='vendor/chart.js/Chart.min.js') }}"></script>
<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
<script>

function plot_daily_cases(){
    var confirmed = {
      x: {{labels | tojson}},
      y: {{confirmed | tojson}},
      name: 'Confirmed',
      type: 'scatter'
    };

    var deaths = {
      x: {{labels | tojson}},
      y: {{deaths | tojson}},
      name: 'Deaths',
      type: 'scatter'
    };

    var recovered = {
      x: {{labels | tojson}},
      y: {{recovered | tojson}},
      name: 'Recovered',
      type: 'scatter'
    };

    var data = [confirmed, deaths, recovered];

    var layout = {
      title: 'Daily cases',
      legend: {
        y: 0.5,
        traceorder: 'reversed',
        font: {
          size: 16
        }
      }
    };

    var config = {
        responsive: true,
        displayModeBar: false
    }
    Plotly.newPlot('daily_cases', data, layout, config);
}

function plot_predictions(div_id, title, label_reported, label_predicted, acumulated, predictions){
    var reported = {
      x: label_reported,
      y: acumulated,
      name: 'Reported',
      mode: 'lines+markers',
      marker: { size: 5, color: 'green' },
      type: 'scatter'
    };

    var predicted = {
      x: label_predicted,
      y: predictions,
      name: 'Predicted',
      mode: 'markers',
      marker: { size: 3 },
      type: 'scatter'
    };

    var data = [predicted, reported];

    var layout = {
      title: title,
      xaxis: {
        type: 'date'
      },
      legend: {
        y: 0.5,
        traceorder: 'reversed',
        font: {
          size: 16
        }
      }
    };

    var config = {
        responsive: true,
        displayModeBar: false
    }
    Plotly.newPlot(div_id, data, layout, config);
}


plot_daily_cases()
plot_predictions("confirmed_predictions", 'Confirmed projections', {{labels | tojson}} , {{predicted_labels | tojson}}, {{acumulated_confirmed | tojson}}, {{predictions_confirmed | tojson}})
plot_predictions("death_predictions", 'Deaths prejections', {{labels | tojson}} , {{predicted_labels | tojson}}, {{acumulated_deaths | tojson}}, {{predictions_deaths | tojson}})
plot_predictions("recovered_predictions", 'Recovered projections', {{labels | tojson}} , {{predicted_labels | tojson}}, {{acumulated_recovered | tojson}}, {{predictions_recovered | tojson}})


</script>
{% endblock %}